- Дата создания: 2018-02-12
- RFC PR:
- RFC Issue:
- Flexberry Issue:

# Кэширование выбранных моделей на клиенте

## Краткое описание

В `ember-flexberry-data` уже есть механизм офлайн-моделей, данные которых 
хранятся на клиенте. Предлагается добавить сервисы по синхронизации локальных
данных с данными на сервере.

## Обоснование

В ряде прикладных проектов есть необходимость кэшировать редко изменяемые модели, например, 
справочники. Причина - небыстрые каналы связи или пожелания заказчика. Имея данные 
локально мы добьёмся более отзывчивой работы приложения и снижения количества
запросов на сервер бэкенда.

## Детальное проектирование

В аддоне `ember-flexberry-data` есть поддержка так называемых "офлайновых" моделей, т.е. 
тех, данные которых хранятся в локальном хранилище браузера (IndexedDB), и работа с которыми 
идет через `local-store`. Признак того, что модель является офлайновой может меняться 
динамически. Так же есть сервис `syncer`, который позволяет загружать данные модели в локальное
хранилище и отправлять изменения в бэкенд.

Предлагается реализовать сервис, который бы для указанного набора моделей выполнял синхронизацию 
данных локального хранилища с данными бэкенда. А также сервис - планировщик, запускающий первый 
сервис по расписанию или по сигналу бэкенда.

<!-- Метаданные сохраняемой модели  -->


## Документирование и обучение

1. Стандартная документация добавляемых сервисов.
2. Необходимо будет создать статью по предоставляемым возможностям и использованию 
этого решения в прикладных проектах.

## Недостатки

Функционал предлагаемого решения не всегда востребован на прикладных проектах.
Но если оно будет опциональным (например, будет выполнено в виде аддона), то 
недостатки не просматриваются.

## Альтернативы

Можно рассмотреть механизм кеширования браузера с помощью HTTP заголовков Cache-Control и т.д.
[Подробнее тут](https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching?hl=en#cache-control).
Он требует добавления соответствующего обработчика на стороне бэкенда, который будет добавлять 
заголовок кеширования, валидировать кэш для выбранных запросов.  

Плюс: На клиенте используется стандартный механизм и требуется доработка только бэкенда.   
Минус: Избыточное кэширование запросов с наложенными ограничениями.

Также настройки кэширования в браузере может изменять пользователь, что нужно учитывать.

## Нерешенные вопросы

Уточнить:
* Как делать частичную синхронизацию данных модели.
* Возможность синхронизации модели по сигналу с сервера.
