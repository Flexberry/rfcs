- Дата создания: 2023-05-30
- RFC PR: 
- RFC Issue: 
- Flexberry Issue:

# Поддержка генерации новых типов приложений из Flexberry Designer

## Краткое описание

Сейчас Flexberry Designer позволяет генерировать несколько типов .NET-приложений: 
WinForms, ASP.NET WebForms, ODataBackend для .NET Framework и ASP.NET Core. 

У прикладных проектов может возникать потребность создания еще некоторых типов .NET-приложений,
использующих объекты данных и бизнес-сервера, а также сервисы Flexberry ORM и других подсистем
Flexberry Platform, а именно: приложения WebAPI, консольные приложения, фоновые сервисы.

Предлагается добавить в дизайнере возможность генерации данных типов приложений таким образом,
чтобы в сгенерированном проекте были установлены необходимые пакеты ORM, созданы требуемые
файлы конфигурации, настроены с помощью DI-контейнера с корректным lifetime-ом сервисы Flexberry Platform.

## Обоснование

Сейчас при создании приложений указанных типов разработчикам приходится самостоятельно разбираться 
как корректно установить требуемые технологические пакеты, настроить авторизацию с проверкой полномочий
или без нее, сконфигурировать DI-контейнер. Возможность получать заготовку проекта приложения
с уже настроенными технологическими сервисами ускорит разработку прикладных проектов и снизит
порог входа в создание таких проектов для новичков.

## Детальное проектирование

Добавить специальные стереотипы или специальное свойство для объекта со стереотипом application в 
дизайнере. В этом случае будет возможность описать на уровне модели различные сервисы, входящие в состав
проекта, и использовать эту диаграмму в том числе для формирования проектной документации. Впоследствии 
также можно будет задавать разные настройки аудита, полномочий и других подсистем Flexberry для разных
приложений на уровне модели. 

Дизайнер должен позволять генерировать следующие
типы приложений:

### Приложение WebAPI
Данный тип приложения по набору файлов конфигурации напоминает ODataBackend за исключением того, что
не содержит ODataService и специфичных для него настроек. В свежесгенерированном проекте должны быть 
настроены хелсчеки [средствами ASP.NET Core](https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/health-checks?view=aspnetcore-7.0), 
проверяющие в том числе доступность БД. Результат хелсчеков должен публиковаться на эндпоинте /healthz.

### Консольное приложение
Для данного типа приложения необходимо сгенерировать метод Main с получением настроек приложения из файлов 
конфигурации, настройки логирования и иных подсистем Flexberry с использованием DI-контейнера.

### Фоновый сервис
Данный тип приложения может напоминать по набору файлов конфигурации WebAPI, с тем отличием, что
фоновый сервис обычно запускается как синглтон, поэтому необходимо правильно настраивать внедрение 
зависимостей - если зависимость должна создаваться на время обработки одного запроса (scoped lifetime),
то необходимо создавать scope, существующий на протяжении выполнения обработки конкретного запроса.
В приложении должен генерироваться фоновый сервис с примером корректного резолва технологических
сервисов в методе обработки запроса.
Примером фонового сервиса может быть слушатель шины, RabbitMQ и других брокеров сообщений.

### Sample примеры

Перед доработкой генератора дополнить образец https://github.com/Flexberry/Flexberry.CodeGen.AspNetCoreAndEmber.Sample.git примерами указанных типов приложений. Этот образец выступает эталоном, которому должен соответствовать результат генерации.

## Документирование и обучение

Статьи про каждый из новых типов приложений необходимо добавить в документацию по Flexberry ORM. В документации указать ссылки на соотв сэмпл-примеры

## Недостатки

Необходимо оценить затраты на реализацию и сравнить со временем, которое прикладные проекты затрачивают
на создание таких типов приложений самостоятельно. Если трудоемкость слишком велика, это может
оказаться нерентабельной задачей.

## Альтернативы

Реализовать отдельные плагины для генерации разных типов приложений, как это сделано для 
WinForms и WebForms. В том числе добавить отдельные флаги в настройки генерации и в файл `.fdg`.
Этот механизм проще в реализации, поскольку уже есть реализованные таким образом генераторы для разных
поддерживаемых типов проектов. При этом генератор будет генерировать одинаковые настройки подсистем
Flexberry для всех вариантов приложения, что может быть неудобно и требовать дополнительных действий
по донастройке от прикладного разработчика.

Пока выбран вариант 1 - со стереотипами. Т.к такой вариант будет проще для конечного пользователя.
## Нерешенные вопросы
